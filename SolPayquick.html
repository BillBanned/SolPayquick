<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Solana Payment Gateway</title>
  <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.js"></script>
</head>
<body>
  <h1>Solana Payment Gateway</h1>

  <!-- Connect Phantom Wallet -->
  <button id="connectButton">Connect Wallet</button>
  <p id="walletAddress"></p>

  <!-- Payment Button -->
  <button id="payButton" disabled>Pay 0.01 SOL</button>

  <script>
    // Solana Connection Setup
    const recipientAddress = "5RDjHNH9FGEN7gSGAw6oVS7QhDsvBEV2C3Y9NhrYBQaQ"; // Recipient's address
    const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl("mainnet-beta"));
    let wallet = null;

    // Connect Phantom Wallet
    async function connectWallet() {
      if (window?.phantom?.solana?.isPhantom) {
        wallet = window.phantom.solana;
        try {
          const resp = await wallet.connect();
          document.getElementById("walletAddress").innerText = `Connected: ${resp.publicKey.toString()}`;
          document.getElementById("payButton").disabled = false; // Enable the pay button after connection
        } catch (err) {
          console.error("User rejected the connection:", err);
          alert("Connection rejected. Please try again.");
        }
      } else {
        alert("Phantom Wallet not found. Please install it from https://phantom.app");
      }
    }

    // Send SOL (0.01 SOL) to the recipient address
    async function sendSol() {
      if (!wallet || !wallet.publicKey) return;

      const recipientPubkey = new solanaWeb3.PublicKey(recipientAddress);
      const senderPubkey = wallet.publicKey;

      const transaction = new solanaWeb3.Transaction().add(
        solanaWeb3.SystemProgram.transfer({
          fromPubkey: senderPubkey,
          toPubkey: recipientPubkey,
          lamports: solanaWeb3.LAMPORTS_PER_SOL * 0.01, // 0.01 SOL
        })
      );

      try {
        const { blockhash } = await connection.getLatestBlockhash();
        transaction.recentBlockhash = blockhash;
        transaction.feePayer = senderPubkey;

        // Sign and send the transaction
        const signature = await wallet.signAndSendTransaction(transaction);
        await connection.confirmTransaction(signature);

        alert(`Transaction successful! Signature: ${signature}`);
      } catch (err) {
        console.error("Transaction failed:", err);
        alert("Transaction failed. See console for details.");
      }
    }

    // Set up button event listeners
    window.addEventListener("DOMContentLoaded", () => {
      document.getElementById("connectButton").addEventListener("click", connectWallet);
      document.getElementById("payButton").addEventListener("click", sendSol);
    });
  </script>
</body>
</html>
